<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Market Maker: Heavy Supply</title>
<script src="https://cdn.jsdelivr.net/npm/lightweight-charts@4.1.0/dist/lightweight-charts.standalone.production.js"></script>
<style>
    body { margin: 0; background: #0b0e11; color: #c9d1d9; font-family: 'Roboto Mono', monospace; overflow-y: auto; -webkit-tap-highlight-color: transparent; }
    .wrapper { max-width: 600px; margin: 0 auto; padding: 10px; }
    
    /* HUD */
    .header { text-align: center; margin-bottom: 15px; }
    h3 { margin: 5px 0; color: #f0f6fc; text-transform: uppercase; letter-spacing: 1px; }
    .status-text { font-size: 11px; color: #8b949e; height: 15px; font-weight: bold;}

    /* BARS */
    .bar-container { margin-bottom: 12px; }
    .bar-label-row { display: flex; justify-content: space-between; font-size: 11px; margin-bottom: 4px; }
    .bar-bg { width: 100%; height: 10px; background: #21262d; border-radius: 4px; overflow: hidden; position: relative; }
    
    .fill-supply { height: 100%; background: #da3633; width: 50%; transition: width 0.5s ease-out; }
    .fill-fomo { height: 100%; background: #238636; width: 0%; transition: width 0.5s ease-out; }

    .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 10px; }
    .stat-card {
        background: #161b22; padding: 10px; border: 1px solid #30363d; border-radius: 6px;
        display: flex; flex-direction: column; justify-content: space-between;
    }
    .stat-label { font-size: 10px; color: #8b949e; text-transform: uppercase; }
    .stat-val { font-size: 15px; font-weight: 700; color: #f0f6fc; }
    .usd { color: #3fb950; }
    
    .chart-box { border: 1px solid #30363d; background: #0d1117; height: 260px; margin-bottom: 15px; border-radius: 6px; overflow: hidden; }
    #chart { width: 100%; height: 100%; }

    .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    button {
        padding: 18px 5px; border: none; border-radius: 6px; font-weight: 700; font-family: inherit; font-size: 14px;
        cursor: pointer; color: #fff; transition: transform 0.1s;
        border-bottom: 4px solid rgba(0,0,0,0.2); position: relative; overflow: hidden;
    }
    button:active { transform: translateY(2px); border-bottom: 1px solid rgba(0,0,0,0.2); }
    
    .btn-dump { background: #da3633; } 
    .btn-pump { background: #238636; } 
    .sub-btn { display: block; font-size: 10px; font-weight: 400; opacity: 0.8; margin-top: 2px;}

    #log { font-size: 10px; color: #8b949e; text-align: center; margin-top: 10px; height: 20px; }

    /* Flash Effects */
    @keyframes flashGreen { 0% { background-color: #238636; } 100% { background-color: #21262d; } }
    @keyframes flashRed { 0% { background-color: #da3633; } 100% { background-color: #21262d; } }
    .flash-g { animation: flashGreen 0.3s; }
    .flash-r { animation: flashRed 0.3s; }
</style>
</head>
<body>

<div class="wrapper">
    <div class="header">
        <h3>Liquidity Wars v4</h3>
        <div class="status-text" id="status-text">INITIALIZING...</div>
    </div>

    <div class="bar-container">
        <div class="bar-label-row">
            <span class="stat-label">SUPPLY WALL (RESISTANCE)</span>
            <span class="stat-val" id="val-supply">40%</span>
        </div>
        <div class="bar-bg" id="bg-supply"><div class="fill-supply" id="bar-supply"></div></div>
    </div>

    <div class="bar-container">
        <div class="bar-label-row">
            <span class="stat-label">FOMO (MOMENTUM)</span>
            <span class="stat-val" id="val-fomo">0%</span>
        </div>
        <div class="bar-bg" id="bg-fomo"><div class="fill-fomo" id="bar-fomo"></div></div>
    </div>

    <div class="stats-grid">
        <div class="stat-card">
            <span class="stat-label">LIQUIDITY (USDT)</span>
            <span class="stat-val usd" id="ui-usd">$1,000,000</span>
        </div>
        <div class="stat-card">
            <span class="stat-label">INVENTORY (BTC)</span>
            <span class="stat-val" id="ui-btc">50.00</span>
        </div>
    </div>

    <div class="chart-box"><div id="chart"></div></div>

    <div class="controls">
        <button class="btn-dump" onclick="actionDump()">
            DUMP
            <span class="sub-btn">Chip away Supply (-5%)</span>
        </button>
        <button class="btn-pump" onclick="actionPump()">
            PUMP
            <span class="sub-btn">Push Price / Ignite FOMO</span>
        </button>
    </div>
    <div id="log">Supply is heavy. Grind it down.</div>
</div>

<script>
// --- CONFIGURATION ---
const CANDLE_TIME = 10; // Seconds per candle
let balanceUSD = 1000000;
let balanceBTC = 50;
let price = 1000;

// GAME STATE
let supply = 0.40; // 40% - Heavy, sticky
let fomo = 0.0;    // 0% - Volatile
let isMania = false;

// CHART
const chart = LightweightCharts.createChart(document.getElementById('chart'), {
    layout: { background: { color: '#0d1117' }, textColor: '#8b949e' },
    grid: { vertLines: { color: '#21262d' }, horzLines: { color: '#21262d' } },
    timeScale: { timeVisible: true, secondsVisible: true, rightOffset: 5 },
    rightPriceScale: { borderVisible: false },
});
const candleSeries = chart.addCandlestickSeries({
    upColor: '#238636', downColor: '#da3633', borderVisible: false, wickUpColor: '#238636', wickDownColor: '#da3633'
});

// Initial Candle
let currentBar = { 
    time: Math.floor(Date.now()/1000/CANDLE_TIME)*CANDLE_TIME, 
    open: price, high: price, low: price, close: price 
};
candleSeries.update(currentBar);

// --- HELPERS ---
function updateLog(msg, color) {
    const el = document.getElementById('log');
    el.innerText = msg;
    if(color) el.style.color = color;
}
function flash(id, type) {
    const el = document.getElementById(id);
    el.classList.remove('flash-g', 'flash-r');
    void el.offsetWidth;
    el.classList.add(type === 'g' ? 'flash-g' : 'flash-r');
}

// --- ENGINE (1 sec tick) ---
function tick() {
    const now = Math.floor(Date.now()/1000);
    
    // 1. MANIA LOGIC (Auto-win)
    if(fomo >= 0.95) isMania = true;
    if(fomo < 0.70) isMania = false;

    if (isMania) {
        // Retail frenzy
        price += price * 0.02; // Fast climb
        if(balanceBTC > 0.1) {
            balanceBTC -= 0.2; // They buy your bags
            balanceUSD += 0.2 * price;
        }
        fomo -= 0.03; // Burns fuel fast
    } 
    else {
        // 2. NORMAL MARKET
        
        // FOMO Decay (It's hard to keep excitement)
        if(fomo > 0) fomo -= 0.015;

        // Supply Drift (Slowly returns if price is high)
        if(price > 1100 && supply < 0.8) {
            supply += 0.002; // Very slow creep
        }

        // PRICE PHYSICS
        // Net Pressure = FOMO (Buyers) - Supply (Sellers)
        let pressure = fomo - supply;
        
        // If Supply is huge (>60%), it acts as a gravity well
        if(supply > 0.6) pressure -= 0.05; 

        // Apply movement
        let move = price * (pressure * 0.015); 
        price += move;
    }

    // CLAMP
    if(fomo<0) fomo=0; if(fomo>1) fomo=1;
    if(supply<0) supply=0; if(supply>1) supply=1;

    updateCandle(now);
    updateUI();
}

// --- ACTIONS ---

function actionPump() {
    if(balanceUSD < 15000) { updateLog("Insufficient USD!", "#da3633"); return; }
    
    // Check Supply Wall
    let efficiency = 1.0;
    if(supply > 0.6) {
        efficiency = 0.2; // 80% money burned if supply is high
        updateLog("HITTING THE SUPPLY WALL! BURN!", "#da3633");
    } else {
        updateLog("PUMP! Igniting FOMO.", "#238636");
    }

    let cost = 15000;
    balanceUSD -= cost;
    balanceBTC += (cost / price);

    // Price Impact
    price += (cost/1000) * efficiency;

    // Stats Impact
    fomo += 0.15;        // Big boost to FOMO
    supply += 0.03;      // Small boost to Supply (Sticky)
    
    flash('bg-fomo', 'g');
    updateCandle(Math.floor(Date.now()/1000));
    updateUI();
}

function actionDump() {
    if(balanceBTC < 2) { updateLog("No BTC to dump!", "#da3633"); return; }

    let btcAmt = 3;
    balanceBTC -= btcAmt;
    balanceUSD += btcAmt * price;

    // Price Impact
    price -= price * 0.03;

    // Stats Impact (Hard to remove supply)
    supply -= 0.06; // Only -6% per dump. Needs grinding.
    fomo -= 0.05;   // Small hit to FOMO

    updateLog("DUMP! Chipping away resistance.", "#da3633");
    flash('bg-supply', 'g'); // Green flash because lowering supply is good
    
    updateCandle(Math.floor(Date.now()/1000));
    updateUI();
}

// --- CHARTING ---
function updateCandle(nowTime) {
    // Round to nearest Candle Timeframe
    const candleTime = Math.floor(nowTime / CANDLE_TIME) * CANDLE_TIME;

    // If we moved to a new timeframe block
    if (candleTime !== currentBar.time) {
        // Create new bar
        currentBar = { 
            time: candleTime, 
            open: price, high: price, low: price, close: price 
        };
    } else {
        // Update existing
        if (price > currentBar.high) currentBar.high = price;
        if (price < currentBar.low) currentBar.low = price;
        currentBar.close = price;
    }
    candleSeries.update(currentBar);
}

function updateUI() {
    document.getElementById('ui-usd').innerText = '$' + Math.floor(balanceUSD).toLocaleString();
    document.getElementById('ui-btc').innerText = balanceBTC.toFixed(2);

    let sPct = Math.floor(supply * 100);
    let fPct = Math.floor(fomo * 100);
    
    document.getElementById('val-supply').innerText = sPct + '%';
    document.getElementById('bar-supply').style.width = sPct + '%';
    
    document.getElementById('val-fomo').innerText = fPct + '%';
    document.getElementById('bar-fomo').style.width = fPct + '%';

    // UI Feedback
    const st = document.getElementById('status-text');
    if(isMania) {
        st.innerText = "!!! MANIA MODE !!!"; st.style.color = "#3fb950";
    } else if (supply > 0.6) {
        st.innerText = "WALL TOO THICK. DUMP NEEDED."; st.style.color = "#da3633";
    } else if (fomo > supply) {
        st.innerText = "UPTREND ESTABLISHED"; st.style.color = "#3fb950";
    } else {
        st.innerText = "CHOPPY / ACCUMULATION"; st.style.color = "#8b949e";
    }
}

setInterval(tick, 1000);
</script>
</body>
</html>
