<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Market Maker: Active Warfare</title>
<script src="https://cdn.jsdelivr.net/npm/lightweight-charts@4.1.0/dist/lightweight-charts.standalone.production.js"></script>
<style>
    body { margin: 0; background: #0b0e11; color: #c9d1d9; font-family: 'Roboto Mono', monospace; overflow-y: auto; -webkit-tap-highlight-color: transparent; }
    .wrapper { max-width: 600px; margin: 0 auto; padding: 10px; }
    
    /* HUD */
    .header { text-align: center; margin-bottom: 15px; }
    h3 { margin: 5px 0; color: #f0f6fc; text-transform: uppercase; letter-spacing: 1px; }
    .status-text { font-size: 11px; color: #8b949e; height: 15px; font-weight: bold;}

    /* BARS */
    .bar-container { margin-bottom: 12px; }
    .bar-label-row { display: flex; justify-content: space-between; font-size: 11px; margin-bottom: 4px; }
    .bar-bg { width: 100%; height: 10px; background: #21262d; border-radius: 4px; overflow: hidden; position: relative; }
    
    /* Colors */
    .fill-supply { height: 100%; background: #da3633; width: 50%; transition: width 0.3s ease-out; }
    .fill-fomo { height: 100%; background: #238636; width: 0%; transition: width 0.3s ease-out; }

    .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 10px; }
    .stat-card {
        background: #161b22; padding: 10px; border: 1px solid #30363d; border-radius: 6px;
        display: flex; flex-direction: column; justify-content: space-between;
    }
    .stat-label { font-size: 10px; color: #8b949e; text-transform: uppercase; }
    .stat-val { font-size: 15px; font-weight: 700; color: #f0f6fc; }
    .usd { color: #3fb950; }
    
    .chart-box { border: 1px solid #30363d; background: #0d1117; height: 260px; margin-bottom: 15px; border-radius: 6px; overflow: hidden; }
    #chart { width: 100%; height: 100%; }

    .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    button {
        padding: 18px 5px; border: none; border-radius: 6px; font-weight: 700; font-family: inherit; font-size: 14px;
        cursor: pointer; color: #fff; transition: transform 0.1s;
        border-bottom: 4px solid rgba(0,0,0,0.2); position: relative; overflow: hidden;
    }
    button:active { transform: translateY(2px); border-bottom: 1px solid rgba(0,0,0,0.2); }
    
    .btn-dump { background: #da3633; } 
    .btn-pump { background: #238636; } 
    .sub-btn { display: block; font-size: 10px; font-weight: 400; opacity: 0.8; margin-top: 2px;}

    #log { font-size: 10px; color: #8b949e; text-align: center; margin-top: 10px; height: 20px; }
    
    /* Feedback Animations */
    @keyframes flashGreen { 0% { background-color: #238636; } 100% { background-color: #21262d; } }
    @keyframes flashRed { 0% { background-color: #da3633; } 100% { background-color: #21262d; } }
    .flash-g { animation: flashGreen 0.5s; }
    .flash-r { animation: flashRed 0.5s; }
</style>
</head>
<body>

<div class="wrapper">
    <div class="header">
        <h3>Liquidity Wars v3</h3>
        <div class="status-text" id="status-text">WAITING FOR PUMP...</div>
    </div>

    <div class="bar-container">
        <div class="bar-label-row">
            <span class="stat-label">SELLING PRESSURE (SUPPLY)</span>
            <span class="stat-val" id="val-supply">20%</span>
        </div>
        <div class="bar-bg" id="bg-supply">
            <div class="fill-supply" id="bar-supply"></div>
        </div>
    </div>

    <div class="bar-container">
        <div class="bar-label-row">
            <span class="stat-label">BUYING PRESSURE (FOMO)</span>
            <span class="stat-val" id="val-fomo">0%</span>
        </div>
        <div class="bar-bg" id="bg-fomo">
            <div class="fill-fomo" id="bar-fomo"></div>
        </div>
    </div>

    <div class="stats-grid">
        <div class="stat-card">
            <span class="stat-label">LIQUIDITY (USDT)</span>
            <span class="stat-val usd" id="ui-usd">$1,000,000</span>
        </div>
        <div class="stat-card">
            <span class="stat-label">INVENTORY (BTC)</span>
            <span class="stat-val" id="ui-btc">50.00</span>
        </div>
    </div>

    <div class="chart-box"><div id="chart"></div></div>

    <div class="controls">
        <button class="btn-dump" onclick="actionDump()">
            DUMP
            <span class="sub-btn">Kill Supply / Cheap entry</span>
        </button>
        <button class="btn-pump" onclick="actionPump()">
            PUMP
            <span class="sub-btn">Ignite FOMO / Raise Price</span>
        </button>
    </div>
    <div id="log">Start buying to wake them up...</div>
</div>

<script>
// --- CONFIGURATION ---
let balanceUSD = 1000000;
let balanceBTC = 50;
let price = 1000;

// GAME VARIABLES
let supply = 0.20;    // Starts low (20%), grows with price
let fomo = 0.0;       // Starts at 0, grows ONLY with Pumps
let isMania = false;

// CHART SETUP
const chart = LightweightCharts.createChart(document.getElementById('chart'), {
    layout: { background: { color: '#0d1117' }, textColor: '#8b949e' },
    grid: { vertLines: { color: '#21262d' }, horzLines: { color: '#21262d' } },
    timeScale: { timeVisible: true, secondsVisible: true, rightOffset: 5 },
    rightPriceScale: { borderVisible: false },
});
const candleSeries = chart.addCandlestickSeries({
    upColor: '#238636', downColor: '#da3633', borderVisible: false, wickUpColor: '#238636', wickDownColor: '#da3633'
});
let currentBar = { time: Math.floor(Date.now()/1000), open: price, high: price, low: price, close: price };
candleSeries.update(currentBar);

// --- LOGIC ---

function updateLog(msg, color) {
    const el = document.getElementById('log');
    el.innerText = msg;
    if(color) el.style.color = color;
}

function flashBar(id, type) {
    const el = document.getElementById(id);
    el.classList.remove('flash-g', 'flash-r');
    void el.offsetWidth; // trigger reflow
    el.classList.add(type === 'good' ? 'flash-g' : 'flash-r');
}

// THE HEARTBEAT (1 sec)
function tick() {
    const now = Math.floor(Date.now()/1000);
    
    // 1. MANIA CHECK
    if(fomo >= 1.0) isMania = true;
    if(fomo < 0.8) isMania = false;

    if(isMania) {
        // --- MANIA MODE: Retail buys aggressively ---
        price += price * 0.015; // Auto growth
        
        // Retail buys YOUR bags automatically (if you have BTC)
        if(balanceBTC > 0.5) {
            let sold = 0.5;
            balanceBTC -= sold;
            balanceUSD += sold * price;
        }
        fomo -= 0.02; // Mania burns out fast
    } 
    else {
        // --- NORMAL MARKET PHYSICS ---
        
        // DECAY: FOMO cools down if you don't pump
        if(fomo > 0) fomo -= 0.02; 
        
        // SUPPLY CREEP: If price is high, sellers slowly appear
        if(price > 1200 && supply < 1.0) {
            supply += 0.01; 
        }

        // BATTLE: Demand (FOMO) vs Supply
        // If FOMO (0.6) > Supply (0.4) => Price moves UP
        // If FOMO (0.2) < Supply (0.5) => Price moves DOWN
        
        let sentimentDiff = fomo - supply; 
        let movePercent = sentimentDiff * 0.01; // 1% impact max per tick
        
        price += price * movePercent;
    }

    // Limits
    if(fomo < 0) fomo = 0; if(fomo > 1) fomo = 1;
    if(supply < 0) supply = 0; if(supply > 1) supply = 1;

    updateCandle(now);
    updateUI();
}

function actionPump() {
    if(balanceUSD < 10000) { updateLog("No USD left!", "#da3633"); return; }
    
    // PUMP EFFECT
    // 1. Price UP
    // 2. FOMO UP (Key mechanic)
    // 3. Supply UP (Side effect)
    
    let pumpPower = 15000;
    
    // Resistance logic: If supply is high, pump is less effective on price
    let effectiveness = 1 - (supply * 0.8); // 1.0 to 0.2
    
    balanceUSD -= pumpPower;
    balanceBTC += (pumpPower / price);
    
    let priceImpact = (pumpPower / 500) * effectiveness; 
    price += priceImpact;

    // MECHANICS
    fomo += 0.15;   // You ignite the spark
    supply += 0.08; // But you also attract sellers (Profit Taking)

    updateLog("PUMP! FOMO rising, but Supply grows...", "#238636");
    flashBar('bg-fomo', 'good');
    
    updateCandle(Math.floor(Date.now()/1000));
    updateUI();
}

function actionDump() {
    if(balanceBTC < 1) { updateLog("No BTC to dump!", "#da3633"); return; }
    
    // DUMP EFFECT
    // 1. Price DOWN
    // 2. Supply DOWN (HUGE DROP - The Goal)
    // 3. FOMO DOWN (Small drop - The Cost)
    
    let dumpAmount = 3; // BTC
    balanceBTC -= dumpAmount;
    balanceUSD += dumpAmount * price;
    
    price -= price * 0.04; // Hard drop

    // MECHANICS
    supply -= 0.25; // Shakeout successful!
    fomo -= 0.05;   // Slight fear, but less than the supply drop

    updateLog("DUMP! Sellers panicked. Path cleared.", "#da3633");
    flashBar('bg-supply', 'good'); // Good because we want low supply
    
    updateCandle(Math.floor(Date.now()/1000));
    updateUI();
}

function updateCandle(now) {
    if(price > currentBar.high) currentBar.high = price;
    if(price < currentBar.low) currentBar.low = price;
    currentBar.close = price;
    
    if (now - currentBar.time > 10) {
         currentBar = { time: now, open: price, high: price, low: price, close: price };
    }
    candleSeries.update(currentBar);
}

function updateUI() {
    document.getElementById('ui-usd').innerText = '$' + Math.floor(balanceUSD).toLocaleString();
    document.getElementById('ui-btc').innerText = balanceBTC.toFixed(2);
    
    // Bars
    let sPct = Math.floor(supply * 100);
    let fPct = Math.floor(fomo * 100);
    
    document.getElementById('val-supply').innerText = sPct + '%';
    document.getElementById('bar-supply').style.width = sPct + '%';
    
    document.getElementById('val-fomo').innerText = fPct + '%';
    document.getElementById('bar-fomo').style.width = fPct + '%';
    
    // Status Text
    const st = document.getElementById('status-text');
    if(isMania) {
        st.innerText = "!!! MANIA MODE !!!";
        st.style.color = "#3fb950";
    } else {
        if(fomo > supply) {
            st.innerText = "DEMAND > SUPPLY (RISING)";
            st.style.color = "#3fb950";
        } else if (supply > fomo + 0.2) {
            st.innerText = "SUPPLY WALL (STALLED)";
            st.style.color = "#da3633";
        } else {
             st.innerText = "NEUTRAL / CHOPPY";
             st.style.color = "#8b949e";
        }
    }
}

setInterval(tick, 1000);
</script>
</body>
</html>
